<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Happy New Year üíõ</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  height:100vh;
  overflow:hidden;
  background:radial-gradient(circle at bottom,#0b1d3a,#020409);
  font-family:'Segoe UI',sans-serif;
  color:#fff;
}

/* ===== CENTER ===== */
.center{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  z-index:5;
}

#countdown{
  font-size:90px;
  font-weight:800;
  color:#ffd700;
  text-shadow:0 0 40px rgba(255,215,0,.9);
  animation:pulse 1s infinite;
}
@keyframes pulse{
  0%{transform:scale(1);}
  50%{transform:scale(1.15);}
  100%{transform:scale(1);}
}

#name{
  margin-top:14px;
  font-size:38px;
  letter-spacing:2px;
  text-shadow:0 0 20px rgba(255,255,255,.8);
}

/* ===== LETTER ===== */
#letter{
  display:none;
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(6px);
  z-index:12;
  justify-content:center;
  align-items:center;
  padding:24px;
}

.paper{
  position:relative;
  background:#fff;
  color:#333;
  max-width:360px;
  padding:26px;
  border-radius:14px;
  font-family:'Segoe Script','Comic Sans MS',cursive;
  line-height:1.7;
  animation:fadeUp 2s ease forwards;
}

/* CLOSE BUTTON */
.close-btn{
  position:absolute;
  top:10px;
  right:14px;
  font-size:22px;
  cursor:pointer;
  color:#999;
}
.close-btn:hover{color:#000;}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(40px);}
  to{opacity:1;transform:translateY(0);}
}

/* ===== HEART ===== */
.heart{
  position:absolute;
  width:14px;
  height:14px;
  background:#ff4d6d;
  transform:rotate(45deg);
  opacity:.8;
  animation:heartFloat 10s linear forwards;
}
.heart::before,.heart::after{
  content:"";
  position:absolute;
  width:14px;
  height:14px;
  background:#ff4d6d;
  border-radius:50%;
}
.heart::before{top:-7px;left:0;}
.heart::after{left:-7px;top:0;}

@keyframes heartFloat{
  from{transform:translateY(100vh) rotate(45deg);opacity:0;}
  20%{opacity:1;}
  to{transform:translateY(-15vh) rotate(45deg);opacity:0;}
}

/* ===== MUSIC BUTTON ===== */
.music-btn{
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:20;
  width:48px;
  height:48px;
  border-radius:50%;
  background:rgba(255,255,255,.15);
  backdrop-filter:blur(6px);
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:22px;
  cursor:pointer;
  user-select:none;
}
.music-btn.active{
  animation:spin 4s linear infinite;
}
@keyframes spin{
  from{transform:rotate(0);}
  to{transform:rotate(360deg);}
}

/* CANVAS */
canvas{
  position:absolute;
  inset:0;
}
</style>
</head>

<body>

<!-- MUSIC -->
<audio id="bgm" loop>
  <source src="love.mp3" type="audio/mpeg">
</audio>

<div class="music-btn" id="musicBtn">üéµ</div>

<div class="center">
  <div id="countdown">5</div>
  <div id="name"></div>
</div>

<div id="letter">
  <div class="paper">
    <div class="close-btn" onclick="closeLetter()">‚úï</div>
    G·ª≠i ChouChou,<br><br>
    NƒÉm m·ªõi ch√∫c congchua lu√¥n vui v·∫ª v√† h·∫°nh ph√∫c,<br>
    M·ªçi chuy·ªán xui x·∫ªo, kh√¥ng vui ƒëi·ªÅu bi·∫øn ƒëi h·∫øt<br>
    Mong nƒÉm nay c·ªßa congchua s·∫Ω b√¨nh y√™n h∆°n<br>
    V√† mong congchua h√£y lu√¥n nh·ªõ r·∫±ng,<br>
    V·∫´n c√≥ m·ªôt n∆°i m√† ch·ªã kh√¥ng c·∫ßn ph·∫£i ph√≤ng b·ªã<br>
    L√†m nh·ªØng ƒëi·ªÅu ch·ªã mu·ªën l√†m n√≥i nh·ªØng ƒëi·ªÅu ch·ªã mu·ªën n√≥i üíõ<br><br>
    Happy New Year, My Princess ‚ú®<br>
    Y√™u Ch·ªã üñ§
  </div>
</div>

<canvas id="canvas"></canvas>

<script>
/* ===== CONFIG ===== */
const loverName = "Happy New Year, My Princess ‚ú®";

/* ===== MUSIC ===== */
const bgm=document.getElementById("bgm");
const musicBtn=document.getElementById("musicBtn");
let playing=false;

musicBtn.onclick=()=>{
  if(!playing){
    bgm.play();
    musicBtn.classList.add("active");
  }else{
    bgm.pause();
    musicBtn.classList.remove("active");
  }
  playing=!playing;
};

/* ===== COUNTDOWN ===== */
let count=5;
const cd=document.getElementById("countdown");
const nameEl=document.getElementById("name");

const timer=setInterval(()=>{
  count--;
  cd.textContent=count;
  if(count===0){
    clearInterval(timer);
    cd.style.display="none";
    typeName();
    startFireworks();
    startHearts();
    setTimeout(()=>document.getElementById("letter").style.display="flex",13000);
  }
},1000);

/* TYPE NAME */
let i=0;
function typeName(){
  const t=setInterval(()=>{
    nameEl.textContent+=loverName[i];
    i++;
    if(i>=loverName.length) clearInterval(t);
  },180);
}

/* CLOSE LETTER */
function closeLetter(){
  document.getElementById("letter").style.display="none";
}

/* ===== CANVAS ===== */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

const gravity=0.04;
let stars=[],rockets=[],particles=[],fogOffset=0;

/* STARS */
for(let i=0;i<120;i++){
  stars.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:Math.random()*1.5,
    a:Math.random()
  });
}

/* ROCKET */
class Rocket{
  constructor(){
    this.x=Math.random()*canvas.width;
    this.y=canvas.height;
    this.vx=(Math.random()-0.5)*1.5;
    this.vy=-(Math.random()*3+6);
    this.explodeY=Math.random()*canvas.height*0.45+canvas.height*0.1;
  }
  update(){
    this.x+=this.vx;
    this.y+=this.vy;
    this.vy+=gravity*0.3;
    if(this.y<=this.explodeY){
      explode(this.x,this.y);
      return false;
    }
    return true;
  }
  draw(){
    ctx.fillStyle="#fff";
    ctx.fillRect(this.x,this.y,2,6);
  }
}

/* PARTICLE */
class Particle{
  constructor(x,y,color,type){
    const angle=Math.random()*Math.PI*2;
    const speed=type==="willow"?Math.random()*3+1:Math.random()*4+2;
    this.x=x;this.y=y;
    this.vx=Math.cos(angle)*speed;
    this.vy=Math.sin(angle)*speed;
    this.life=type==="willow"?160:120;
    this.alpha=1;
    this.color=color;
  }
  update(){
    this.x+=this.vx;
    this.y+=this.vy;
    this.vy+=gravity;
    this.alpha-=0.006;
    this.life--;
  }
  draw(){
    ctx.save();
    ctx.globalAlpha=this.alpha;
    ctx.beginPath();
    ctx.arc(this.x,this.y,2,0,Math.PI*2);
    ctx.fillStyle=this.color;
    ctx.fill();
    ctx.restore();
  }
}

function explode(x,y){
  const colors=["#ff004f","#ffd700","#00eaff","#7cff00","#ffffff"];
  const type=Math.random()>0.7?"willow":"burst";
  for(let i=0;i<140;i++){
    particles.push(new Particle(x,y,colors[Math.random()*colors.length|0],type));
  }
}

/* HEARTS */
function startHearts(){
  setInterval(()=>{
    const h=document.createElement("div");
    h.className="heart";
    h.style.left=Math.random()*100+"vw";
    h.style.animationDuration=(8+Math.random()*4)+"s";
    document.body.appendChild(h);
    setTimeout(()=>h.remove(),12000);
  },600);
}

/* ANIMATE */
function animate(){
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  stars.forEach(s=>{
    s.a+=Math.random()*0.02-0.01;
    ctx.globalAlpha=Math.max(0,Math.min(1,s.a));
    ctx.fillStyle="#fff";
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
  ctx.globalAlpha=1;

  rockets=rockets.filter(r=>r.update());
  rockets.forEach(r=>r.draw());

  particles=particles.filter(p=>p.life>0 && p.alpha>0);
  particles.forEach(p=>{p.update();p.draw();});

  fogOffset+=0.15;
  ctx.fillStyle="rgba(255,255,255,0.02)";
  ctx.fillRect(-fogOffset,0,canvas.width,canvas.height);

  requestAnimationFrame(animate);
}

function startFireworks(){
  setInterval(()=>rockets.push(new Rocket()),700);
  animate();
}

addEventListener("resize",()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
});
</script>

</body>
</html>
